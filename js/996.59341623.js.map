{"version":3,"file":"js/996.59341623.js","mappings":"0kGA+CA,MAAM,MAAEA,IAAUC,EAAAA,EAAAA,OACZ,YAAEC,IAAgBC,EAAAA,EAAAA,KAClBC,GAAQC,EAAAA,EAAAA,MACRC,GAAQC,EAAAA,EAAAA,IAAS,CACnBC,oBAAqBC,6CACrBC,aAAc,KACdC,mBAAoBF,6CACpBG,YAAa,KACbC,QAAQ,EACRC,MAAO,EACPC,MAAO,KAGXC,EAAAA,EAAAA,KAAM,IAAMZ,EAAMa,UAAS,KACvBC,GAAS,KAEbC,EAAAA,EAAAA,KAAUC,UACNd,EAAMI,aAAe,IAAIW,EAAAA,GAAgBf,EAAME,oBAAqBc,EAAMtB,EAAMuB,UAAUC,aAC1FlB,EAAMM,YAAc,IAAIS,EAAAA,GAAgBf,EAAMK,mBAAoBc,EAAKzB,EAAMuB,UAAUC,aACvFN,GAAS,IAGb,MAAMA,EAAWE,UACbd,EAAMO,aAAeP,EAAMI,aAAaG,OAAOT,EAAMa,SACrDX,EAAMQ,YAAcR,EAAMI,aAAaI,QACvC,MAAMY,QAAuBpB,EAAMI,aAAaK,QAChDT,EAAMS,MAAQY,WAAWC,EAAAA,GAAkBF,IAC3CG,GAAsB,EAEpBA,EAAwBT,UAC1B,MAAMU,QAAkBxB,EAAMM,YAAYkB,UAAU1B,EAAMa,QAASX,EAAME,qBACrEsB,EAAUC,GAAGH,EAAAA,GAAiBtB,EAAMS,MAAMiB,aAC1C5B,EAAM6B,iBAAkB,EAExB7B,EAAM6B,iBAAkB,CAC3B,EAGCC,EAAkBd,UACpB,GAAIhB,EAAM6B,gBAAiB,CACvB,cACA,MAAME,QAAkB7B,EAAMI,aAAayB,YAC3CA,EAAUC,OACV9B,EAAMO,QAAS,EACfP,EAAMQ,MAAQuB,SAAS/B,EAAMQ,OAAS,CACzC,KAAM,CACH,cACA,MAAMwB,QAAgBhC,EAAMM,YAAY0B,QAAQhC,EAAME,oBAAqB+B,EAAAA,IAC3ED,EAAQF,OACRhC,EAAM6B,iBAAkB,EACxBC,GACH,GAGCM,EAAwBpB,UAC1B,UACUlB,EAAYI,EAAME,qBACxB,YAAciC,EAAAA,EAAAA,OAAAA,EAAc,qBAG/B,CAFC,MAAOC,GACL,SAAWD,EAAAA,EAAAA,OAAAA,EAAc,kBAC5B,G,24BCrGL,MAAME,GAA2B,OAAgB,EAAQ,CAAC,CAAC,YAAY,qBAEvE,O","sources":["webpack://sad/./src/views/ApplyNode.vue","webpack://sad/./src/views/ApplyNode.vue?68bd"],"sourcesContent":["<template>\n    <div>\n        <div class=\"box-style node-box\">\n            <div class=\"gradient-label-box\">\n                <label class=\"gradient-label\">{{ $t('home.applyNode') }}</label>\n            </div>\n            <div class=\"node-address-title\">\n                <div>{{ $t('appleNode.nodeAddress') }}</div>\n                <div @click=\"clickCopyNodeAddress\"><img src=\"@/assets/common/copy.png\" alt=\"\"></div>\n            </div>\n            <div class=\"address-info-box\">\n                <div class=\"address-info\">\n                    {{ state.nodeContractAddress }}\n                </div>\n            </div>\n        </div>\n        <div class=\"box-style node-equity-box\">\n            <div class=\"gradient-label-box\">\n                <label class=\"gradient-label\">{{ state.total }}</label>\n            </div>\n            <div class=\"applications-number\">{{ $t('appleNode.applicationsNumber') }}</div>\n            <div class=\"node-equity-title\">{{ $t('appleNode.nodeEquity') }}</div>\n            <div class=\"node-equity-info-box\">\n                <div class=\"node-equity-info\">{{ $t('appleNode.nodeEquityInfo') }}</div>\n            </div>\n            <div class=\"apple-button-box\">\n                <div class=\"button-style apple-button-font\" style=\"opacity: 0.5;\" v-if=\"state.isNode\">\n                    {{ $t('appleNode.alreadyApplied') }}\n                </div>\n                <div class=\"button-style apple-button-font\" v-else @click=\"clickAppleNode\">\n                    {{ $t('appleNode.apple') }} ({{ $t('appleNode.pay') }} {{ state.price }} SAD)\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script setup>\nimport { reactive, onMounted, getCurrentInstance, watch } from 'vue';\nimport { useRoute } from 'vue-router';\nimport node from '@/json/node.json'\nimport sad from '@/json/sad.json'\nimport { ethers, utils, constants } from 'ethers';\nimport { Toast } from 'vant';\nimport useClipboard from 'vue-clipboard3'\nimport i18n from '@/i18n';\n\nconst { proxy } = getCurrentInstance()\nconst { toClipboard } = useClipboard()\nconst route = useRoute()\nconst state = reactive({\n    nodeContractAddress: process.env.VUE_APP_NODE_CONTRACT_ADDRESS,\n    nodeContract: null,\n    sadContractAddress: process.env.VUE_APP_SAD_CONTRACT_ADDRESS,\n    sadContract: null,\n    isNode: false,\n    total: 0,\n    price: 0,\n})\n\nwatch(() => route.account, () => {\n    getData()\n})\nonMounted(async () => {\n    state.nodeContract = new ethers.Contract(state.nodeContractAddress, node, proxy.$provider.getSigner())\n    state.sadContract = new ethers.Contract(state.sadContractAddress, sad, proxy.$provider.getSigner())\n    getData()\n})\n\nconst getData = (async () => {\n    state.isNode = await state.nodeContract.isNode(route.account)\n    state.total = await state.nodeContract.total()\n    const appleNodePrice = await state.nodeContract.price()\n    state.price = parseFloat(utils.formatEther(appleNodePrice))\n    checkAuthorizeStatus()\n})\nconst checkAuthorizeStatus = (async () => {\n    const allowance = await state.sadContract.allowance(route.account, state.nodeContractAddress)\n    if (allowance.gt(utils.parseEther(state.price.toString()))) {\n        route.isNodeAuthorize = true\n    } else {\n        route.isNodeAuthorize = false\n    }\n})\n\nconst clickAppleNode = (async () => {\n    if (route.isNodeAuthorize) {\n        Toast.loading()\n        const applyNode = await state.nodeContract.applyNode()\n        applyNode.wait()\n        state.isNode = true\n        state.total = parseInt(state.total) + 1\n    } else {\n        Toast.loading()\n        const approve = await state.sadContract.approve(state.nodeContractAddress, constants.MaxUint256)\n        approve.wait()\n        route.isNodeAuthorize = true\n        clickAppleNode()\n    }\n})\n\nconst clickCopyNodeAddress = (async () => {\n    try {\n        await toClipboard(state.nodeContractAddress)\n        Toast.success(i18n.global.t('toast.copySuccess'))\n    } catch (error) {\n        Toast.fail(i18n.global.t('toast.copyFail'))\n    }\n})\n\n</script>\n\n<style lang=\"less\" scoped>\n@import '@/common/base.less';\n\n.node-box {\n    margin: 10px 15px;\n    background: url('@/assets/appleNode/apple-node-background.png') no-repeat;\n    background-size: 100%;\n\n    .node-address-title {\n        margin: 136px 15px 0 15px;\n        display: flex;\n        justify-content: space-between;\n        height: 24px;\n        line-height: 24px;\n        .scw(@titleColorOne, 14px, 500);\n        font-family: PingFangSC-Medium, PingFang SC;\n\n        img {\n            height: 24px;\n        }\n    }\n\n    .address-info-box {\n        margin: 8px 15px 0 15px;\n        padding-bottom: 15px;\n\n        .address-info {\n            border-radius: 6px;\n            padding: 10px;\n            border: 1px solid #373B44;\n            background: #2E3138;\n            .scw(@titleColorTwo, 14px, 500);\n            font-family: PingFangSC-Medium, PingFang SC;\n            text-align: left;\n            overflow-wrap: break-word;\n        }\n    }\n}\n\n.node-equity-box {\n    margin: 0 15px 15px 15px;\n\n    .applications-number {\n        margin-top: 1px;\n        .scw(@titleColorTwo, 12px, 500);\n        font-family: PingFangSC-Medium, PingFang SC;\n    }\n\n    .node-equity-title {\n        margin: 15px 15px 0 15px;\n        .scw(@titleColorTwo, 14px, 500);\n        font-family: PingFangSC-Medium, PingFang SC;\n        text-align: left;\n    }\n\n    .node-equity-info-box {\n        margin: 10px 15px;\n        background: #2E3138;\n        border-radius: 6px;\n        border: 1px solid #373B44;\n\n        .node-equity-info {\n            margin: 10px;\n            text-align: left;\n            white-space: pre-wrap;\n            line-height: 22px;\n            .scw(@titleColorOne, 12px, 400);\n        }\n    }\n\n    .apple-button-box {\n        margin: 15px;\n        padding-bottom: 15px;\n\n        .apple-button-font {\n            font-size: 14px;\n        }\n    }\n}\n</style>","import script from \"./ApplyNode.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ApplyNode.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./ApplyNode.vue?vue&type=style&index=0&id=cd07677c&lang=less&scoped=true\"\n\nimport exportComponent from \"/Users/leonis/workspace/projects/hyc/hyc-web/sad/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-cd07677c\"]])\n\nexport default __exports__"],"names":["proxy","getCurrentInstance","toClipboard","useClipboard","route","useRoute","state","reactive","nodeContractAddress","process","nodeContract","sadContractAddress","sadContract","isNode","total","price","watch","account","getData","onMounted","async","ethers","node","$provider","getSigner","sad","appleNodePrice","parseFloat","utils","checkAuthorizeStatus","allowance","gt","toString","isNodeAuthorize","clickAppleNode","applyNode","wait","parseInt","approve","constants","clickCopyNodeAddress","i18n","error","__exports__"],"sourceRoot":""}