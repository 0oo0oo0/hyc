{"version":3,"file":"js/136.ee170f78.js","mappings":"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","sources":["webpack://sad/./src/views/SADStaking.vue","webpack://sad/./src/views/SADStaking.vue?536b"],"sourcesContent":["<template>\n    <div class=\"box-style fluidity-box\">\n        <div class=\"gradient-label-box\">\n            <label class=\"gradient-label\">SAD {{ $t('home.staking') }}</label>\n        </div>\n        <div class=\"total-pledge\">\n            <label class=\"pledge-title\">{{ $t('hycFluidity.totalPledge') }}</label>\n            <label class=\"pledge-info\">{{ state.totalPledge.toFixed(4) }} SAD</label>\n        </div>\n        <div class=\"income-rate\">\n            <label class=\"pledge-title\">{{ $t('sadFluidity.incomeRate') }}</label>\n            <label class=\"pledge-info\">{{ state.rewardRate }} %</label>\n        </div>\n        <div class=\"income-rate\">\n            <label class=\"pledge-title\">{{ $t('hycFluidity.myPledge') }}</label>\n            <label class=\"pledge-info\">{{ state.myPledge.toFixed(4) }} SAD</label>\n        </div>\n        <div class=\"input-box\">\n            <van-field v-model=\"state.pledgeNumber\" :placeholder=\"$t('hycFluidity.inputPlaceholder')\">\n                <template #button>\n                    <div class=\" gradient-label\" @click=\"clickPledgeAll\">\n                        {{ $t('hycFluidity.all') }}\n                    </div>\n                </template>\n            </van-field>\n        </div>\n        <div class=\"income-rate\">\n            <label class=\"pledge-title\">{{ $t('hycFluidity.availableBalance') }}</label>\n            <label class=\"pledge-info\">{{ state.sadBalance.toFixed(4) }} SAD</label>\n        </div>\n        <div class=\"button-box\">\n            <div class=\"button-style button-font\"\n                :style=\"(state.pledgeNumber > 0) ? ('opacity: 1;') : ('opacity: 0.5;')\" @click=\"clickPledge\">\n                {{ $t('hycFluidity.pledge') }}\n            </div>\n        </div>\n        <div class=\"my-income\">\n            <label class=\"pledge-title\">{{ $t('hycFluidity.myIncome') }}</label>\n            <label class=\"pledge-info\">{{ state.myIncome.toFixed(8) }} SAD</label>\n        </div>\n        <div class=\"button-box function-button-box\">\n            <div class=\"button-style button-font item-button\"\n                :style=\"(state.myPledge > 0) ? ('opacity: 1;') : ('opacity: 0.5;')\" @click=\"clickQuitPledge\">\n                {{ $t('hycFluidity.quit') }}\n            </div>\n            <div class=\"button-style button-font item-button\"\n                :style=\"(state.myIncome > 0) ? ('opacity: 1;') : ('opacity: 0.5;')\" @click=\"clickExtract\">\n                {{ $t('hycFluidity.extract') }}\n            </div>\n        </div>\n    </div>\n</template>\n\n<script setup>\nimport { reactive, ref, onMounted, onUnmounted, getCurrentInstance, watch } from 'vue';\nimport { useRoute } from 'vue-router';\nimport staking from '@/json/staking.json'\nimport sad from '@/json/sad.json'\nimport { ethers, utils, constants } from 'ethers';\nimport { Toast } from 'vant';\nimport i18n from '@/i18n';\n\nconst { proxy } = getCurrentInstance()\nconst route = useRoute()\nconst timer = ref(0)\n\nconst state = reactive({\n    stakingContractAddress: process.env.VUE_APP_SAD_STAKING_CONTRACT_ADDRESS,\n    stakingContract: null,\n    sadContractAddress: process.env.VUE_APP_SAD_CONTRACT_ADDRESS,\n    sadContract: null,\n\n    totalPledge: 0,\n    rewardRate: 0,\n    myPledge: 0,\n    sadBalance: 0,\n    myIncome: 0,\n    pledgeNumber: 0\n})\n\nwatch(() => route.account, () => {\n    checkAuthorizeStatus()\n    getUserInfo()\n})\nonMounted(async () => {\n    state.stakingContract = new ethers.Contract(state.stakingContractAddress, staking, proxy.$provider.getSigner())\n    state.sadContract = new ethers.Contract(state.sadContractAddress, sad, proxy.$provider.getSigner())\n    setIntervalRefreshData()\n    checkAuthorizeStatus()\n    getRewardRate()\n    getTotalSupply()\n    getUserInfo()\n})\n\nconst setIntervalRefreshData = (() => {\n    timer.value = window.setInterval(async () => {\n        getTotalSupply()\n        getUserInfo()\n    }, 3000)\n})\nconst clearIntervalRefreshData = (() => {\n    window.clearInterval(timer.value)\n})\n\nonUnmounted(() => {\n    clearIntervalRefreshData()\n})\n\nconst getTotalSupply = (async () => {\n    const totalSupply = await state.stakingContract.totalSupply()\n    state.totalPledge = parseFloat(utils.formatEther(totalSupply))\n})\nconst getRewardRate = (async () => {\n    const rate = await state.stakingContract.rewardRate()\n    state.rewardRate = rate / 100\n})\nconst getUserInfo = (async () => {\n    const balanceOf = await state.stakingContract.balanceOf(route.account)\n    state.myPledge = parseFloat(utils.formatEther(balanceOf))\n\n    const sadBalanceOf = await state.sadContract.balanceOf(route.account)\n    state.sadBalance = parseFloat(utils.formatEther(sadBalanceOf))\n\n    const rewards = await state.stakingContract.rewards(route.account)\n    state.myIncome = parseFloat(utils.formatEther(rewards))\n})\n\nconst checkAuthorizeStatus = (async () => {\n    const allowance = await state.sadContract.allowance(route.account, state.stakingContractAddress)\n    if (allowance.eq(constants.MaxUint256)) {\n        route.isSADAuthorize = true\n    } else {\n        route.isSADAuthorize = false\n    }\n})\n\nconst clickPledgeAll = (() => {\n    state.pledgeNumber = state.sadBalance\n})\nconst clickPledge = (async () => {\n    if (state.pledgeNumber > state.sadBalance) {\n        Toast.fail(i18n.global.t('toast.insufficientBalance'))\n    } else if (parseFloat(state.pledgeNumber) > 0) {\n        startPledge()\n    } else {\n        Toast.fail(i18n.global.t('toast.inputError'))\n    }\n})\n\nconst startPledge = (async () => {\n    if (route.isSADAuthorize) {\n        Toast.loading()\n        const stake = await state.stakingContract.stake(utils.parseEther(state.pledgeNumber.toString()))\n        stake.wait()\n        state.pledgeNumber = 0\n        getTotalSupply()\n        getUserInfo()\n    } else {\n        Toast.loading()\n        const approve = await state.sadContract.approve(state.stakingContractAddress, constants.MaxUint256)\n        approve.wait()\n        route.isSADAuthorize = true\n        startPledge()\n    }\n})\n\nconst clickQuitPledge = (async () => {\n    if (state.myPledge > 0) {\n        Toast.loading()\n        const exit = await state.stakingContract.exit()\n        exit.wait()\n    }\n})\n\nconst clickExtract = (async () => {\n    if (state.myIncome > 0) {\n        Toast.loading()\n        const reward = await state.stakingContract.getReward()\n        reward.wait()\n        getUserInfo()\n    }\n})\n</script>\n\n<style lang=\"less\" scoped>\n@import '@/common/base.less';\n\n.pledge-title {\n    .scw(@titleColorTwo, 14px, 500);\n    font-family: PingFangSC-Medium, PingFang SC;\n}\n\n.pledge-info {\n    .scw(@titleColorOne, 14px, 500);\n    font-family: PingFangSC-Medium, PingFang SC;\n}\n\n.button-box {\n    margin: 15px;\n\n    // opacity: 0.5;\n    .button-font {\n        font-size: 14px;\n    }\n}\n\n.fluidity-box {\n    margin: 10px 15px;\n\n    .total-pledge {\n        margin: 15px 15px 0 15px;\n        display: flex;\n        justify-content: space-between;\n    }\n\n    .income-rate {\n        margin: 10px 15px 0 15px;\n        display: flex;\n        justify-content: space-between;\n    }\n\n    .my-income {\n        margin: 20px 15px 0 15px;\n        display: flex;\n        justify-content: space-between;\n    }\n\n    .function-button-box {\n        display: flex;\n        justify-content: space-between;\n\n        .item-button {\n            width: calc(calc(100% - 10px) / 2.0);\n        }\n    }\n}\n</style>","import script from \"./SADStaking.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./SADStaking.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./SADStaking.vue?vue&type=style&index=0&id=480eae99&lang=less&scoped=true\"\n\nimport exportComponent from \"/Users/leonis/workspace/projects/hyc/hyc-web/sad/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-480eae99\"]])\n\nexport default __exports__"],"names":["proxy","getCurrentInstance","route","useRoute","timer","ref","state","reactive","stakingContractAddress","process","stakingContract","sadContractAddress","sadContract","totalPledge","rewardRate","myPledge","sadBalance","myIncome","pledgeNumber","watch","account","checkAuthorizeStatus","getUserInfo","onMounted","async","ethers","staking","$provider","getSigner","sad","setIntervalRefreshData","getRewardRate","getTotalSupply","value","window","setInterval","clearIntervalRefreshData","clearInterval","onUnmounted","totalSupply","parseFloat","utils","rate","balanceOf","sadBalanceOf","rewards","allowance","eq","constants","isSADAuthorize","clickPledgeAll","clickPledge","i18n","startPledge","stake","toString","wait","approve","clickQuitPledge","exit","clickExtract","reward","getReward","__exports__"],"sourceRoot":""}